<main class="flex-1 px-10 py-8">
  <!-- Header -->
  <div class="flex justify-between items-end mb-10">
    <h1 class="text-4xl font-light tracking-tight">All Credential</h1>

    <button
      (click)="openAddModal()"
      class="cursor-pointer items-center gap-2 px-4 py-2 bg-zinc-50 text-zinc-950 rounded-full hover:bg-zinc-200 transition-all font-medium text-sm active:scale-95"
    >
      <span>+</span> Add Credential
    </button>
  </div>

  <!-- Loading -->
  @if (isLoading()) {
    <p class="text-neutral-500">Decrypting your vault...</p>
  } @else {

  <!-- Card Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    @for (item of filteredItems(); track item.id) {
      <div
        (click)="selectItem(item)"
        class="group cursor-pointer rounded-xl border border-zinc-800 bg-zinc-950/60 p-5
               hover:border-amber-500/40 hover:bg-zinc-900/60 transition-all
               active:scale-[0.98]"
      >
        <!-- Card Header -->
        <div class="flex items-start justify-between mb-4">
          <div>
            <h3 class="text-lg font-medium text-zinc-50 flex items-center gap-2">
              {{ item.title }}

              @if (item.ownerId !== vaultState.user()?.id) {
                <span
                  class="text-[10px] bg-amber-600 text-zinc-50 px-2 py-0.5 rounded-full uppercase tracking-tight"
                >
                  Shared
                </span>
              }
            </h3>

            <p class="text-sm text-neutral-400 mt-1 truncate">
              {{ item.username }}
            </p>
          </div>
        </div>

        <!-- Card Footer -->
        <div class="mt-6 flex items-center justify-between text-xs text-neutral-500">
          <span>
            Updated {{ formatDate(item.updatedAt) }}
          </span>

          <span class="opacity-0 group-hover:opacity-100 transition">
            View →
          </span>
        </div>
      </div>
    }

    @empty {
      <p class="col-span-full text-neutral-500 text-center py-10">
        No credentials found matching "{{ vaultState.searchQuery() }}"
      </p>
    }
  </div>
  }
</main>

<!-- Add Credential Modal -->
@if (isAddModalOpen()) {
<div
  (click)="closeAddModal()"
  class="fixed inset-0 z-[60] flex items-center justify-center bg-black/90 backdrop-blur-md p-4"
>
  <div (click)="$event.stopPropagation()" class="w-full max-w-2xl">
    <app-credential (cancel)="closeAddModal()" />
  </div>
</div>
}

<!-- Credential Detail Modal -->
@if (selectedItem()) {
<div
  (click)="closePopup()"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"
>
  <section
    (click)="$event.stopPropagation()"
    class="bg-zinc-950 text-zinc-50 p-8 rounded-xl border border-neutral-800 w-full max-w-2xl shadow-2xl"
  >
    <h2 class="text-3xl font-light mb-8 tracking-tight text-center">
      {{ isEditMode() ? 'Edit Credential' : 'Credential Details' }}
    </h2>

    <div class="space-y-6">
      <!-- Service -->
      <div class="space-y-1">
        <label class="text-xs text-neutral-500 uppercase tracking-widest">Service</label>
        @if (isEditMode()) {
          <input
            [(ngModel)]="selectedItem().title"
            [disabled]="selectedItem()?.ownerId !== vaultState.user()?.id"
            class="w-full bg-zinc-900 border border-neutral-800 rounded px-3 py-2"
          />
        } @else {
          <p class="text-xl">{{ selectedItem().title }}</p>
        }
      </div>

      <!-- Username -->
      <div class="space-y-1">
        <label class="text-xs text-neutral-500 uppercase tracking-widest">Username</label>
        @if (isEditMode()) {
          <input
            [(ngModel)]="selectedItem().username"
            [disabled]="selectedItem()?.ownerId !== vaultState.user()?.id"
            class="w-full bg-zinc-900 border border-neutral-800 rounded px-3 py-2"
          />
        } @else {
          <div class="bg-zinc-900/50 p-3 rounded border border-neutral-800/50">
            {{ selectedItem().username }}
          </div>
        }
      </div>

      <!-- Password -->
      <div class="space-y-1">
        <label class="text-xs text-neutral-500 uppercase tracking-widest">Password</label>
        <div class="flex items-center justify-between bg-zinc-900 border border-neutral-800 rounded px-4 py-3">
          @if (isEditMode()) {
            <input
              [(ngModel)]="selectedItem().password"
              [type]="showSecret() ? 'text' : 'password'"
              class="w-full bg-transparent font-mono outline-none"
            />
          } @else {
            <p class="font-mono">
              {{ showSecret() ? selectedItem().password : '••••••••••••' }}
            </p>
          }
          <button
            (click)="toggleSecret()"
            class="ml-2 text-neutral-400 hover:text-zinc-50"
          >
            {{ showSecret() ? 'Hide' : 'Show' }}
          </button>
        </div>
      </div>

      <!-- Website -->
      <div class="space-y-1">
        <label class="text-xs text-neutral-500 uppercase tracking-widest">Website</label>
        <div class="bg-zinc-900/30 p-4 rounded border border-neutral-800/50 italic">
          <a [href]="selectedItem().url" target="_blank" class="hover:underline">
            {{ selectedItem().url || 'No URL saved' }}
          </a>
        </div>
      </div>

      <!-- Notes -->
      <div class="space-y-1">
        <label class="text-xs text-neutral-500 uppercase tracking-widest">Notes</label>
        <div class="bg-zinc-900/30 p-4 rounded border border-neutral-800/50 italic min-h-[50px]">
          {{ selectedItem().notes || 'No notes' }}
        </div>
      </div>
    </div>

    <!-- Footer Actions -->
    <div class="mt-10 pt-6 border-t border-neutral-800 flex justify-between items-center">
      <button
        (click)="closePopup()"
        class="text-neutral-400 hover:text-zinc-50 uppercase tracking-widest text-xs"
      >
        Close
      </button>

      @if (selectedItem()?.ownerId === vaultState.user()?.id && !isEditMode()) {
        <button
          (click)="toggleEdit()"
          class="text-blue-400 hover:text-blue-500 uppercase tracking-widest text-xs"
        >
          Edit
        </button>
      }
    </div>
  </section>
</div>
}
